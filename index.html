<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xolosArmy Network State DEX</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }
        header {
            background-color: #4a4a4a;
            color: #fff;
            text-align: center;
            padding: 1rem;
        }
        h1 {
            margin-bottom: 0;
        }
        main {
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .exchange-form, .liquidity-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        input, button {
            padding: 10px;
            font-size: 16px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        #status, #transactionHistory, #walletInfo {
            margin-top: 20px;
        }
        #transactionHistory, #walletInfo {
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>
</head>
<body>
    <header>
        <h1>xolosArmy Network State DEX</h1>
        <p>A decentralized exchange for Xolos $RMZ Token</p>
    </header>
    <main>
        <div id="walletInfo">
            <h2>Wallet Information</h2>
            <p>Address: <span id="walletAddress">Not connected</span></p>
            <p>Balance: <span id="walletBalance">0</span> BCH</p>
            <button onclick="connectWallet()">Connect Wallet</button>
        </div>
        <h2>Exchange BCH for Xolos $RMZ</h2>
        <div class="exchange-form">
            <input type="number" id="bchAmount" placeholder="BCH amount">
            <input type="number" id="minTokens" placeholder="Minimum Xolos $RMZ tokens">
            <button onclick="swapBCHForToken()">Swap BCH for Xolos $RMZ</button>
        </div>
        <h2>Add Liquidity</h2>
        <div class="liquidity-form">
            <input type="number" id="bchLiquidityAmount" placeholder="BCH amount">
            <input type="number" id="tokenLiquidityAmount" placeholder="Xolos $RMZ token amount">
            <button onclick="addLiquidity()">Add Liquidity</button>
        </div>
        <div id="status"></div>
        <div id="transactionHistory">
            <h3>Transaction History</h3>
            <ul id="transactions"></ul>
        </div>
    </main>
    <script>
        const contractAddress = "0xAd90E94ee8489A563F8FD41c75F56d1b97556414";
        const contractABI = [
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_token",
				"type": "address"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "provider",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amountBCH",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amountToken",
				"type": "uint256"
			}
		],
		"name": "LiquidityAdded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "provider",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amountBCH",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amountToken",
				"type": "uint256"
			}
		],
		"name": "LiquidityRemoved",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "swapper",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amountIn",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amountOut",
				"type": "uint256"
			}
		],
		"name": "Swapped",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "tokenAmount",
				"type": "uint256"
			}
		],
		"name": "addLiquidity",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "liquidity",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "removeLiquidity",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "minTokens",
				"type": "uint256"
			}
		],
		"name": "swapBCHForToken",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "tokenAmount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "minBCH",
				"type": "uint256"
			}
		],
		"name": "swapTokenForBCH",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "token",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "totalLiquidity",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
        const explorerBaseUrl = 'https://smartscout.cash/tx/';
        let web3;
        let contract;
        let wallet;

        async function connectWallet() {
            const statusDiv = document.getElementById('status');
            try {
                if (typeof window.ethereum !== 'undefined') {
                    web3 = new Web3(window.ethereum);
                    const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                    if (accounts.length === 0) {
                        throw new Error('No accounts found. Please create an account in your wallet.');
                    }
                    wallet = accounts[0];
                    document.getElementById('walletAddress').textContent = wallet;
                    
                    // Fetch balance
                    const balance = await web3.eth.getBalance(wallet);
                    const balanceInBCH = web3.utils.fromWei(balance, 'ether'); // Convert wei to BCH
                    document.getElementById('walletBalance').textContent = balanceInBCH;
                    
                    statusDiv.textContent = 'Wallet connected successfully!';
                    contract = new web3.eth.Contract(contractABI, contractAddress);
                } else {
                    throw new Error('MetaMask wallet not detected. Please install MetaMask.');
                }
            } catch (error) {
                statusDiv.textContent = `Error connecting wallet: ${error.message}`;
                console.error('Wallet connection error:', error);
            }
        }

        async function addLiquidity() {
            const statusDiv = document.getElementById('status');
            if (!wallet) {
                statusDiv.textContent = 'Please connect your wallet first.';
                return;
            }

            const bchAmount = document.getElementById('bchLiquidityAmount').value;
            const tokenAmount = document.getElementById('tokenLiquidityAmount').value;

            statusDiv.textContent = `Adding ${bchAmount} BCH and ${tokenAmount} Xolos $RMZ tokens to the liquidity pool...`;

            try {
                await contract.methods.addLiquidity(tokenAmount).send({ from: wallet, value: web3.utils.toWei(bchAmount, 'ether') });
                statusDiv.textContent = `Successfully added liquidity: ${bchAmount} BCH and ${tokenAmount} Xolos $RMZ tokens.`;
            } catch (error) {
                statusDiv.textContent = `Error: ${error.message}`;
                console.error('Add liquidity error:', error);
            }
        }

        async function swapBCHForToken() {
            const statusDiv = document.getElementById('status');
            if (!wallet) {
                statusDiv.textContent = 'Please connect your wallet first.';
                return;
            }

            const bchAmount = document.getElementById('bchAmount').value;
            const minTokens = document.getElementById('minTokens').value;

            statusDiv.textContent = `Swapping ${bchAmount} BCH for at least ${minTokens} Xolos $RMZ tokens...`;

            try {
                await contract.methods.swapBCHForToken(minTokens).send({ from: wallet, value: web3.utils.toWei(bchAmount, 'ether') });
                statusDiv.textContent = `Successfully swapped ${bchAmount} BCH for at least ${minTokens} Xolos $RMZ tokens.`;
            } catch (error) {
                statusDiv.textContent = `Error: ${error.message}`;
                console.error('Swap error:', error);
            }
        }

        function addTransactionToHistory(txHash, amount) {
            const transactionsList = document.getElementById('transactions');
            const listItem = document.createElement('li');
            const link = document.createElement('a');
            link.href = explorerBaseUrl + txHash;
            link.textContent = `Transaction of ${amount} BCH - View on Explorer`;
            link.target = '_blank';
            listItem.appendChild(link);
            transactionsList.appendChild(listItem);
        }
    </script>
</body>
</html>
