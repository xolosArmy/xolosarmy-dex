<!DOCTYPE html>
<html>
<head>
    <title>Xolos Army DEX</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>
</head>
<body>
    <h1>Xolos Army DEX</h1>
    <div>
        <button onclick="connectWallet()">Connect Wallet</button>
        <p>Wallet Address: <span id="walletAddress"></span></p>
        <p>Wallet Balance: <span id="walletBalance"></span> ETH</p>
    </div>

    <h2>Swap BCH for RMZ</h2>
    <div>
        <input type="text" id="bchAmount" placeholder="BCH Amount">
        <input type="text" id="minTokens" placeholder="Min RMZ">
        <button onclick="swapBCHForToken()">Swap</button>
        <p id="swapStatus"></p>
    </div>

    <h2>Swap RMZ for BCH</h2>
    <div>
        <input type="text" id="tokenAmount" placeholder="RMZ Amount">
        <input type="text" id="minBCH" placeholder="Min BCH">
        <button onclick="swapTokenForBCH()">Swap</button>
        <p id="swapStatus"></p>
    </div>

    <h2>Add Liquidity</h2>
    <div>
        <input type="text" id="liquidityBchAmount" placeholder="BCH Amount">
        <input type="text" id="liquidityRmzAmount" placeholder="RMZ Amount">
        <button onclick="addLiquidity()">Add Liquidity</button>
        <p id="liquidityStatus"></p>
    </div>

    <h2>Remove Liquidity</h2>
    <div>
        <input type="text" id="removeLiquidityAmount" placeholder="Liquidity Amount">
        <button onclick="removeLiquidity()">Remove Liquidity</button>
        <p id="liquidityStatus"></p>
    </div>

    <h2>Transaction History</h2>
    <ul id="transactionHistory"></ul>
    <button onclick="clearHistory()">Clear History</button>

    <script>
        const tokenAddress = '0x49F9ECF126B6dDF51C731614755508A4674bA7eD';
        const liquidityPoolAddress = '0x948134045c356Ba9C72E8cB4C9f4aA93d68506C7';
        const explorerBaseUrl = 'https://smartscout.cash/tx/';
        let wallet = null;
        let web3;
        let liquidityPoolContract;

        const liquidityPoolABI = [
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "tokenAmount",
                        "type": "uint256"
                    }
                ],
                "name": "addLiquidity",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "payable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_token",
                        "type": "address"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "provider",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amountBCH",
                        "type": "uint256"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amountToken",
                        "type": "uint256"
                    }
                ],
                "name": "LiquidityAdded",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "provider",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amountBCH",
                        "type": "uint256"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amountToken",
                        "type": "uint256"
                    }
                ],
                "name": "LiquidityRemoved",
                "type": "event"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "removeLiquidity",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "minTokens",
                        "type": "uint256"
                    }
                ],
                "name": "swapBCHForToken",
                "outputs": [],
                "stateMutability": "payable",
                "type": "function"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "swapper",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amountIn",
                        "type": "uint256"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amountOut",
                        "type": "uint256"
                    },
                    {
                        "indexed": false,
                        "internalType": "bool",
                        "name": "isBCHToToken",
                        "type": "bool"
                    }
                ],
                "name": "Swapped",
                "type": "event"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "tokenAmount",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "minBCH",
                        "type": "uint256"
                    }
                ],
                "name": "swapTokenForBCH",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "name": "liquidity",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "owner",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "token",
                "outputs": [
                    {
                        "internalType": "contract IERC20",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "totalLiquidity",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        function connectWallet() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                window.ethereum.enable().then(function(accounts) {
                    wallet = accounts[0];
                    document.getElementById('walletAddress').textContent = wallet;
                    updateBalance();
                    loadLiquidityPoolContract();
                });
            } else {
                alert('Please install MetaMask to use this feature.');
            }
        }

        async function loadLiquidityPoolContract() {
            liquidityPoolContract = new web3.eth.Contract(liquidityPoolABI, liquidityPoolAddress);
        }

        async function updateBalance() {
            const balance = await web3.eth.getBalance(wallet);
            document.getElementById('walletBalance').textContent = web3.utils.fromWei(balance, 'ether');
        }

        async function swapBCHForToken() {
            const bchAmount = document.getElementById('bchAmount').value;
            const minTokens = document.getElementById('minTokens').value;

            if (!bchAmount || !minTokens) {
                alert('Please enter valid amounts.');
                return;
            }

            const amountInWei = web3.utils.toWei(bchAmount, 'ether');

            liquidityPoolContract.methods.swapBCHForToken(minTokens)
                .send({ from: wallet, value: amountInWei })
                .on('transactionHash', function(hash) {
                    document.getElementById('swapStatus').textContent = `Transaction sent: ${explorerBaseUrl}${hash}`;
                    logTransaction(hash);
                })
                .on('receipt', function(receipt) {
                    document.getElementById('swapStatus').textContent = 'Swap completed!';
                    updateBalance();
                })
                .on('error', function(error) {
                    document.getElementById('swapStatus').textContent = `Error: ${error.message}`;
                });
        }

        async function swapTokenForBCH() {
            const tokenAmount = document.getElementById('tokenAmount').value;
            const minBCH = document.getElementById('minBCH').value;

            if (!tokenAmount || !minBCH) {
                alert('Please enter valid amounts.');
                return;
            }

            liquidityPoolContract.methods.swapTokenForBCH(tokenAmount, minBCH)
                .send({ from: wallet })
                .on('transactionHash', function(hash) {
                    document.getElementById('swapStatus').textContent = `Transaction sent: ${explorerBaseUrl}${hash}`;
                    logTransaction(hash);
                })
                .on('receipt', function(receipt) {
                    document.getElementById('swapStatus').textContent = 'Swap completed!';
                    updateBalance();
                })
                .on('error', function(error) {
                    document.getElementById('swapStatus').textContent = `Error: ${error.message}`;
                });
        }

        async function addLiquidity() {
            const bchAmount = document.getElementById('liquidityBchAmount').value;
            const rmzAmount = document.getElementById('liquidityRmzAmount').value;

            if (!bchAmount || !rmzAmount) {
                alert('Please enter valid amounts.');
                return;
            }

            const bchAmountInWei = web3.utils.toWei(bchAmount, 'ether');

            liquidityPoolContract.methods.addLiquidity(rmzAmount)
                .send({ from: wallet, value: bchAmountInWei })
                .on('transactionHash', function(hash) {
                    document.getElementById('liquidityStatus').textContent = `Transaction sent: ${explorerBaseUrl}${hash}`;
                    logTransaction(hash);
                })
                .on('receipt', function(receipt) {
                    document.getElementById('liquidityStatus').textContent = 'Liquidity added!';
                    updateBalance();
                })
                .on('error', function(error) {
                    document.getElementById('liquidityStatus').textContent = `Error: ${error.message}`;
                });
        }

        async function removeLiquidity() {
            const amount = document.getElementById('removeLiquidityAmount').value;

            if (!amount) {
                alert('Please enter a valid amount.');
                return;
            }

            liquidityPoolContract.methods.removeLiquidity(amount)
                .send({ from: wallet })
                .on('transactionHash', function(hash) {
                    document.getElementById('liquidityStatus').textContent = `Transaction sent: ${explorerBaseUrl}${hash}`;
                    logTransaction(hash);
                })
                .on('receipt', function(receipt) {
                    document.getElementById('liquidityStatus').textContent = 'Liquidity removed!';
                    updateBalance();
                })
                .on('error', function(error) {
                    document.getElementById('liquidityStatus').textContent = `Error: ${error.message}`;
                });
        }

        function logTransaction(hash) {
            const transactionHistory = document.getElementById('transactionHistory');
            const listItem = document.createElement('li');
            listItem.textContent = `${explorerBaseUrl}${hash}`;
            transactionHistory.appendChild(listItem);
        }

        function clearHistory() {
            const transactionHistory = document.getElementById('transactionHistory');
            transactionHistory.innerHTML = '';
        }
    </script>
</body>
</html>